# ch7. 고급매핑

## 상속관계 매핑

- 관계형 데이터베이스에는 객체지향에서 다루는 상속 관계 개념이 없다.
- 때문에 유사한 슈퍼타입 관계라는 유사한 모델링 기법으로 객체와 관계를 매핑

## 상속 관계 매핑을 위한 3가지 전략

1. 조인 전략 - @Inheritance(strategy=InheritanceType.JOINED)

   공통 부분을 부모 테이블로 만들고 자식 테이블이 부모 테이블의 기본 키를 받아서 조인하는 전략이다.

   ![image-20210607230255941](C:\Users\gisung\AppData\Roaming\Typora\typora-user-images\image-20210607230255941.png)

   | 장점                                  | 단점                               |
   | ------------------------------------- | ---------------------------------- |
   | 정규화된 테이블 구조                  | 조회시 조인을 많이 사용, 성능 저하 |
   | 외래 키 참조 무결성 제약조건 활용가능 | 조회 쿼리가 복잡함                 |
   | 저장공간 효율화                       | 데이터 저장시 INSERT 쿼리 2번 실행 |

   

2. 단일 테이블 전략 - @Inheritance(strategy=InheritanceType.SINGEL_TABLE)

   하나의 테이블 안에 전체를 넣고, 구분 컬럼(DTYPE)으로 구분한다.

   ![image-20210607230743790](C:\Users\gisung\AppData\Roaming\Typora\typora-user-images\image-20210607230743790.png)

   | 장점                                | 단점                                                   |
   | ----------------------------------- | ------------------------------------------------------ |
   | 조인이 필요 없어 조회 성능이 빠르다 | 자식 엔티티가 매핑한 컬럼은 모두 NULL을 허용해야 한다. |
   | 조회 쿼리가 단순하다.               | 단일 테이블에서 모든 것을 저장하므로 테이블이 커진다.  |

3. 구현 클래스마다 테이블 전략 - @Inheritance(strategy=InheritanceType.TABLE_PER_CLASS)

   자식 엔티티마다 부모 엔티티의 컬럼의 값을 추가해 테이블을 만든다. 
   **사용을 권장하지 않는다.!!!**

   | 장점                                           | 단점                                                         |
   | ---------------------------------------------- | ------------------------------------------------------------ |
   | 서브 타입을 명확하게 구분해서 처리할 때 효과적 | 여러 자식 테이블을 함께 조회할 때 성능이 느림(UNION SQL 필요) |
   | NOT NULL 제약조건 사용 가능                    | 자식 테이블을 통해서 쿼리하기 어려움                         |

   ![image-20210607231409810](C:\Users\gisung\AppData\Roaming\Typora\typora-user-images\image-20210607231409810.png)

​		